-- Semantic rule X.3.(17)

-- $Id: sr_X3_17.aadl 238 2010-05-26 22:53:05Z lasnier $

package example_sr_X3_17
public

data dt
end dt;

thread th
  features
    p1 : in event data port dt;
    p2 : in event data port dt;
    m : out event data port dt;
end th;

thread implementation th.good 
subcomponents
  x1 : data dt;
  x2 : data dt;
annex behavior_specification {**
  states
    s0 : initial state;
    comp : final state;
    next1 : complete state;
    
  transitions
    s0 -[ ]-> next1 { x1 := p1 };
    next1 -[ on dispatch p2 ]-> comp { x2 := p2 };
**};
end th.good;

thread implementation th.error 
subcomponents
  x1 : data dt;
  x2 : data dt;
annex behavior_specification {**
  states
    s0 : initial state;
    comp : final state;
    next1 : complete state;
    
    -- Error : next2 must be an execution state
    next2 : complete state;
    
  transitions
    -- If s0 is only an initial state so we can have an execute condition
    s0 -[ x1 = 0 ]-> next1 { x1 := p1 };
    next1 -[ on dispatch p1 ]-> next2 { x2 := p2 };  
    next2 -[ x1 = 2 ]-> comp { x2 := p2 };
**};
end th.error;

end example_sr_X3_17;